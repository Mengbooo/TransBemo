# 语音翻译 API 接入文档

本文档是百度翻译开放平台语音翻译API的用户指南，描述了语音翻译相关接口的说明。API接入方式对于IOS端、Android端、Web端均适用。新版本不再提供语音翻译SDK服务，已经接入的用户可下拉至本文档末尾查看SDK错误码列表。

## 接口限制：

- 需要上传完整的录音文件，录音文件时长不超过 60 秒
- 音频编码要求：采样率 16000，16 bit 位深，单声道
- 支持音频语种及格式：

| 语种 | 格式 |
|------|------|
| 中文、粤语 | pcm、wav、amr、m4a |
| 英语、日语、韩语、俄语、德语、法语、泰语、葡萄牙语、西班牙语、阿拉伯语 | pcm |

### 音频格式说明：

- **pcm**（无损音频格式）：也称为 raw 格式。音频输入最原始的格式，不用解码。
- **wav**（无损音频格式，pcm 编码）：在 pcm 格式的开头额外包含一段描述采样率、编码等信息的编码。
- **amr**（有损压缩格式）：对音频数据进行有损压缩，类似 mp3 文件。
- **m4a**（有损压缩格式，AAC 编码）：对音频数据进行有损压缩，通常仅供微信小程序使用的格式。

由于底层识别使用的是 pcm 格式，因此推荐直接上传 pcm 格式。若上传其它格式，在服务器端会有额外转换为 pcm 格式的工作，从而增加一定的调用耗时。

## API接入方式（IOS端、Android端、Web端均适用）

### 如何使用语音翻译API

1. 使用您的百度账号登录百度翻译开放平台；
2. 注册成为开发者，获得APPID；
3. 进行开发者认证；
4. 开通语音翻译API服务；
5. 参考技术文档和Demo编写代码

### 接入方式：

语音翻译API HTTPS地址：`https://fanyi-api.baidu.com/api/trans/v2/voicetrans`

请求方式： POST

## 请求参数

### Headers

| 参数名称 | 示例 | 是否必填 | 备注 |
|---------|------|----------|------|
| Content-Type | application/json | 是 | |
| X-Appid | appid | 是 | APPID 从管理控制台中获得 |
| X-Timestamp | 1642331332 | 是 | Unix时间戳（10位） |
| X-Sign | i1b/6Ml/NxhEhOnsiQIK7nqsPH/avhhlHgfpo84lJC8= | 是 | 请求签名。请参考 请求签名计算方法 小节 |

### Body

| 参数名 | 参数类型 | 是否必填 | 示例 | 备注 |
|--------|----------|----------|------|------|
| from | string | 是 | en | 源语言的语言代码，具体参考语种列表 |
| to | string | 是 | zh | 目标语言的语言代码，具体考语种列表 |
| voice | string | 是 | W3NvdXJjZSBhdWRpbyBieXRlc10K | 语音文件二进制数据，base64编码 |
| format | string | 是 | pcm | 音频文件格式。请参考语言列表和音频格式。需上传完整的音频数据，包含的音频时长不超过 60 秒，并且数据大小不超过4MB（base64编码前） |

**示例**：
```json
{
  "from": "en",
  "to": "zh",
  "format":"pcm",
  "voice": "W3NvdXJjZSBhdWRpbyBieXRlc10K"
}
```

## 响应参数

### Header

| 参数名称 | 参数类型 | 示例 | 备注 |
|---------|----------|------|------|
| X-MT-Logid | string | 970e51a03f5c42ba8868bdad786c13d8 | 返回唯一logid |

### Body

| 参数名称 | 参数类型 | 示例 | 备注 |
|---------|----------|------|------|
| code | int | 0 | 错误码 <br>0：成功 <br>非0：失败 |
| msg | string | Success | 错误信息 |
| data | object | | 结果结构，当且仅当code为 0 时存在 |
| data.source | string | 今天天气不错。 | 语音识别的原文 |
| data.target | string | It's a nice day today. | 翻译后的译文 |
| data.target_tts | string | W2F1ZGlvIGJ5dGVzXQo= | 译文 TTS，base64数据，mp3格式 |

**正常情况**：
```json
{
  "code": 0,
  "msg": "Success",
  "data": {
    "source": "今天天气不错。",  // 识别原文
    "target": "It's a nice day today.",  // 译文
    "target_tts": "W2F1ZGlvIGJ5dGVzXQo="  // 译文TTS ，base64编码
  }
}
```

**异常情况**：
```json
{
  "code": 10000,
  "msg": "Internal server error"
}
```

## 请求签名 X-Sign 计算方法

1. 将音频文件进行base64编码，得到音频编码 ，即用于请求参数中的 voice 字段
2. 拼接字符串： X-Appid +  X-Timestamp + voice  
3. 使用 hmac_sha256 加密算法对（2）中的字符串进行加密，并得到base64格式的签名（因为hmac一般得到的是二进制字节流），做为 X-Sign 。hmac_sha256 的密钥来自于使用翻译开放平台分配的密钥，（可在 管理控制台 - 开发者信息获得）

**示例**：
```python
appid = '2015063000000001'  # 请替换为您的APP ID
timestamp = '1646034877'  # 10位Unix时间戳
voice_bytes = b'00010101011101010101'
secret_key = 'XWG7Gyj'  # 翻译开放平台分配的密钥
# step1: base64编码音频文件
voice = base64encode(voice_bytes)
# step2: 得到待加密的字符串
msg = appid + timestamp + voice
# step3: 加密得到签名，作为`X-Sign`。若hmac得到的是二进制字节，需要进行base64编码
sign = base64encode(hmac_sha256(secret=secret_key, message=msg))
```

各语言hmac_sha256加密方法参考：[hmac_sha256加密方法（点击下载）](#)

## 语种列表

| 编号 | 语言名称 | 缩写 |
|------|----------|------|
| 1 | 中文 | zh |
| 2 | 英语 | en |
| 3 | 日语 | jp |
| 4 | 韩语 | kor |
| 5 | 粤语 | yue |
| 6 | 俄语 | ru |
| 7 | 德语 | de |
| 8 | 法语 | fra |
| 9 | 泰语 | th |
| 10 | 葡萄牙语 | pt |
| 11 | 西班牙语 | spa |
| 12 | 阿拉伯语(巴林) | ara |

## 错误码

| 错误码 | 含义 | 解决方案 |
|--------|------|----------|
| 0 | 成功 | |
| 10001 | 必填参数为空或固定参数有误 | 检查参数是否误传 |
| 10004 | 访问频率受限 | 请降低您的调用频率 |
| 10005 | 签名错误 | 请检查您的签名生成方法 |
| 10006 | 未授权用户 | 请检查 APP ID 是否正确或者短语音翻译服务是否开通 |
| 10007 | 客户端IP非法 | 检查个人资料里填写的IP地址是否正确。可前往管理控制平台修改，IP限制，IP可留空 |
| 20000 | 语言方向不支持 | 检查源语种或目标语种是否在语言列表里 |
| 20200 | 语音翻译请求失败 | 请重试 |
| 20201 | 音频数据大小超过限制 | 请上传符合大小要求的音频数据 |
| 20202 | 文件格式不支持 | 请上传符合格式要求的音频数据 |

## 各语言DEMO
[PHP版（点击下载）](#)

## SDK接入方式

### 错误码列表（Andriod版）
  
| 错误码 | 含义 |
|--------|------|
| 1000 | DNS连接超时 |
| 1001 | 网络连接超时 |
| 1002 | 网络读取超时 |
| 1003 | 上行网络连接超时 |
| 1004 | 上行网络读取超时 |
| 1005 | 下行网络连接超时 |
| 1006 | 下行网络读取超时 |

**解决方案**：出现原因可能为网络已经连接但质量比较差，建议检测网络状态。
  
| 错误码 | 含义 |
|--------|------|
| 2000 | 网络连接失败 |
| 2001 | 网络读取失败 |
| 2002 | 上行网络连接失败 |
| 2003 | 上行网络读取失败 |
| 2004 | 下行网络连接失败 |
| 2005 | 下行网络读取失败 |
| 2006 | 下行数据异常 |
| 2100 | 本地网络不可用 |

**解决方案**：出现原因可能是网络权限被禁用，或网络确实未连接，需要开启网络或检测无法联网的原因。
  
| 错误码 | 含义 |
|--------|------|
| 3001 | 录音机打开失败 |
| 3002 | 录音机参数错误 |
| 3003 | 录音机不可用 |
| 3006 | 录音机读取失败 |
| 3007 | 录音机关闭失败 |
| 3008 | 文件打开失败 |
| 3009 | 文件读取失败 |
| 3010 | 文件关闭失败 |
| 3100 | VAD异常，通常是VAD资源设置不正确 |
| 3101 | 长时间未检测到人说话，请重新识别 |
| 3102 | 检测到人说话，但语音过短 |

**解决方案**：出现原因可能为，未声明录音权限，或被安全软件限制，或录音设备被占用，需要开发者检测权限声明。
  
| 错误码 | 含义 | 解决方案 |
|--------|------|----------|
| 6001 | 未开启长语音时，当输入语音超过60s时，会报此错误 | 语音过长，请配合语音识别的使用场景，如避开嘈杂的环境等。 |
| 7001 | 没有匹配的识别结果。当检测到语音结束，或手动结束时，服务端收到的音频数据质量有问题，导致没有识别结果 | 信噪比差，请配合语音识别的使用场景，如避开嘈杂的环境等。 |
| 9001 | 没有录音权限，通常是没有配置录音权限：android.permission.RECORD_AUDIO | 检查录音权限 |
| 52001 | 请求超时 | 重试 |
| 52002 | 系统错误 | 重试 |
| 52003 | 未授权用户 | 检查您的appid是否正确，或者服务是否开通 |
| 52010 | 已激活设备数量超过最大限制 | 请联系管理员 |
| 54000 | 必填参数为空 | 检查是否少传参数 |
| 54001 | 签名错误 | 请检查您的签名生成方法 |
| 54003 | 访问频率受限 | 请降低您的调用频率 |
| 54004 | 账户余额不足 | 请前往管理控制平台为账户充值 |
| 54005 | 长query请求频繁 | 请降低长query的发送频率，3s后再试 |
| 58000 | 客户端IP非法 | 检查个人资料里填写的IP地址是否正确；可前往管理控制平台修改；IP限制，IP可留空 |
| 58001 | 译文语言方向不支持 | 检查译文语言是否在语言列表里 |
| 69008 | 设备号为空 | 检查cuid参数 |

### 错误码列表（IOS端）

#### 1.翻译SDK错误码

| 错误码 | 含义 |
|--------|------|
| 300 | cuid 缺失 |
| 301 | imei 缺失 |
| 302 | mac 缺失 |
| 303 | file 缺失 |
| 304 | 缺失数据 |
| 305 | 语种不支持语音识别 |
| 306 | 缺失appid |
| 307 | 缺失secretkey |
| 400 | 请求超时 |
| 401 | 请求失败 |
| 402 | 返回数据为空 |
| 403 | 数据格式错误 |

#### 2.语音识别端错误

| 错误码 | 含义 |
|--------|------|
| 3001 | 录音设备异常 |
| 3002 | 无录音权限 |
| 3003 | 录音不可用 |
| 3004 | 录音中断 |
| 3099 | 录音出错 |
| 3101 | 前端库异常 |
| 3102 | 用户未说话 |
| 3103 | 用户说话声音太短 |
| 3199 | 语音数据处理过程出错 |
| 3201 | 在线识别引擎异常 |
| 3202 | 网络不可用 |
| 3203 | 获取token失败 |
| 3204 | 解析url失败 |
| 3205 | 请求超时 |
| 3299 | 本地网络连接出错 |
| 3301 | 协议参数错误 |
| 3302 | 识别过程出错 |
| 3303 | 没有找到匹配结果 |
| 3304 | PID错误 |
| 3305 | 声音不符合识别要求 |
| 3306 | 语音过长（单次query请勿超过60s） |
| 3399 | 服务器错误 |
| 3499 | HTTP协议错误 |
| 3599 | 离线引擎返回错误 |
| 3601 | 识别器忙 |
| 3602 | 垂类设置有误 |
| 3603 | 语音数据enqueue失败 |

#### 3.翻译服务端相关错误
  
| 错误码 | 含义 | 解决方案 |
|--------|------|----------|
| 52001 | 请求超时 | 重试 |
| 52002 | 系统错误 | 重试 |
| 52003 | 未授权用户 | 检查您的 appid 是否正确，或者服务是否开通 |
| 52010 | 开放设备授权容量不足 | 联系管理员扩增容量 |
| 54000 | 必填参数为空或固定参数有误 | 检查参数是否误传 |
| 54001 | 签名错误 | 请检查您的签名生成方法 |
| 54003 | 访问频率受限 | 请降低您的调用频率 |
| 54004 | 账户余额不足 | 请前往管理控制平台为账户充值 |
| 54005 | 长query请求频繁 | 请降低长query的发送频率，3s后再试 |
| 58000 | 客户端IP非法 | 检查个人资料里填写的 IP地址 是否正确可前往管理控制平台修改，IP限制，IP可留空 |
| 58001 | 译文语言方向不支持 | 检查译文语言是否在语言列表里 |
| 69008 | 设备号为空 | 检查cuid参数 |